import { useState, useEffect } from 'react'
import { useRouter } from 'next/router'

import anime from 'animejs'
import { Box, Container, createStyles, Space } from '@mantine/core'

import { useSplash } from '../../contexts/SplashContext'

const useStyles = createStyles((theme) => ({
  container: {
    minHeight: '100vh',

    textAlign: 'center',
    ...theme.other.flexCenter,
  },
  number: { fontSize: '1.1rem', color: theme.colors.orenji },
}))

export default function Splash() {
  const { classes } = useStyles()
  const router = useRouter()

  const { setSplashFinish } = useSplash()
  const [visibility, setVisibility] = useState('hidden')

  const strokeColor = '#f3ef53'
  const strokeWidth = '5'

  useEffect(() => {
    if (router.asPath === '/') {
      anime({
        targets: '#splash path',
        strokeDashoffset: [anime.setDashoffset, 0],
        easing: 'easeInOutSine',
        duration: 750,
        delay: function (el, i) {
          return i * 125
        },
        direction: 'alternate',
        loop: false,
      })

      anime({
        targets: '#counter',
        innerHTML: ['0%', '100%'],
        easing: 'easeOutCirc',
        round: 1,
        duration: 1000,
      })

      setVisibility('visible')

      const timer = setTimeout(() => {
        setSplashFinish()
      }, 1800)

      return () => {
        anime.remove('#splash path')
        anime.remove('#counter')
        clearTimeout(timer)
      }
    } else {
      setSplashFinish()
    }

    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [])

  return (
    <Container className={classes.container}>
      <svg
        visibility={visibility}
        id="splash"
        height="72px"
        viewBox="0 0 909 325"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          fill="none"
          stroke={strokeColor}
          strokeWidth={strokeWidth}
          d="M 30.3522 294.09845 L 183.352188 294.060974 L 188.375366 225.299759 L 170.015366 225.304245 C 166.42189 251.945129 158.147171 273.54715 133.306992 272.833252 L 76.066734 271.767242 C 83.625145 265.2854 89.383652 259.164001 95.861443 250.162399 L 183.312805 133.140991 L 183.308136 114.061005 L 38.948139 114.096313 L 34.284706 181.777466 L 52.644707 181.77298 C 56.59845 156.212006 63.07325 134.970428 82.873161 134.60556 L 137.952988 133.872101 C 135.073608 136.392792 126.795898 145.754822 118.878448 156.196762 L 30.346733 271.778442 Z"
        />
        <path
          fill="none"
          stroke={strokeColor}
          strokeWidth={strokeWidth}
          d="M 165.112198 294.06546 L 252.952179 294.043945 L 252.946564 271.003967 C 246.826538 271.005432 237.106628 271.367828 229.546814 272.089661 C 230.624344 262.009399 230.981537 250.489319 230.979599 242.569321 L 230.971664 210.169327 L 241.41156 209.806778 C 249.333954 219.524826 264.099426 241.841217 278.864349 261.99762 C 293.269012 281.074097 303.712189 294.031525 318.472198 294.027924 L 356.992188 294.018494 L 356.987518 274.938477 C 341.507507 274.942261 325.661865 251.906158 320.260193 245.067474 L 295.772369 213.033463 C 286.769531 201.515671 280.648041 195.397171 272.727173 191.799103 L 297.20047 164.433121 C 308.357574 152.550385 325.273407 135.626251 350.472809 133.100067 L 350.46814 114.020081 L 274.868134 114.038574 L 274.873779 137.078583 L 295.753693 136.71347 C 290.354645 140.674805 286.035889 145.715851 279.197723 153.277527 L 247.166382 188.565369 L 230.96637 188.569321 L 230.925659 22.249329 L 214.365662 22.253387 C 209.326813 26.934631 195.288223 32.698059 162.528229 32.706085 L 162.533951 56.106079 C 169.01387 55.744476 179.81369 55.021851 188.093597 54.659821 C 187.016159 65.100067 186.658615 75.180176 186.660645 83.460175 L 186.698715 238.980164 C 186.703903 260.220154 185.987518 274.980347 165.107529 274.985443 Z"
        />
        <path
          fill="none"
          stroke={strokeColor}
          strokeWidth={strokeWidth}
          d="M 412.713593 299.764832 C 464.913605 299.752075 502.703735 259.422821 502.68927 200.382828 C 502.675598 144.582825 463.066711 108.232513 411.946716 108.245026 C 361.906708 108.257263 321.236755 149.307236 321.251129 207.987228 C 321.264709 263.427246 361.233612 299.777466 412.713593 299.764832 Z M 414.508209 277.804413 C 382.108398 278.532349 368.778351 237.495605 368.768738 198.2556 C 368.760376 164.055603 380.272095 130.212769 411.591919 129.485107 C 443.631836 129.117279 454.802216 171.594543 454.811554 209.754547 C 454.819672 242.874542 446.188232 277.796661 414.508209 277.804413 Z"
        />
        <path
          fill="none"
          stroke={strokeColor}
          strokeWidth={strokeWidth}
          d="M 483.147522 274.907593 L 483.152191 293.98761 L 570.632202 293.966187 L 570.626526 270.926208 C 564.866516 270.927612 555.146606 271.289978 547.586792 272.011841 C 548.664368 261.93158 549.021545 250.411484 549.019592 242.491486 L 548.642822 174.091568 C 555.838684 157.169815 573.473877 137.365509 588.953918 137.72171 C 589.67749 152.121536 600.118958 158.238968 610.198975 158.236511 C 626.759033 158.592453 632.875671 144.91095 632.873413 135.550964 C 632.868713 116.470947 619.186707 108.194305 603.706726 108.19809 C 583.546692 108.203033 564.829895 121.167603 548.275146 142.771667 C 548.272156 130.531677 547.548645 116.131836 546.827271 110.372009 L 531.707275 110.375702 C 526.308411 115.057037 512.989807 120.820313 493.90979 120.824982 L 480.589813 120.828217 L 480.595428 143.868225 C 486.715363 143.506729 497.875244 143.143997 505.795166 142.782059 C 504.717651 152.86232 504.360107 162.942413 504.362122 171.222412 L 504.378723 238.902405 C 504.383911 260.142395 503.667542 274.902588 483.147522 274.907593 Z"
        />
        <path
          fill="none"
          stroke={strokeColor}
          strokeWidth={strokeWidth}
          d="M 603.147522 274.878235 L 603.152161 293.958252 L 690.632202 293.936829 L 690.626526 270.89682 C 684.866516 270.898224 675.146606 271.26062 667.586792 271.982452 C 668.664307 261.902222 669.021545 250.382111 669.019592 242.462112 L 668.642822 174.062195 C 675.838684 157.140442 693.473877 137.336121 708.953918 137.692322 C 709.67749 152.092163 720.118958 158.20961 730.198975 158.207138 C 746.759033 158.56308 752.875671 144.881592 752.873413 135.521576 C 752.868713 116.441589 739.186707 108.164948 723.706726 108.168732 C 703.546692 108.173645 684.829895 121.138245 668.275146 142.742294 C 668.272156 130.502289 667.548645 116.102478 666.827271 110.342651 L 651.707214 110.346344 C 646.308411 115.027679 632.989807 120.790924 613.90979 120.795593 L 600.589783 120.798859 L 600.595459 143.838852 C 606.715332 143.477356 617.875244 143.114624 625.795166 142.752686 C 624.717651 152.832947 624.360107 162.91304 624.362122 171.193039 L 624.378723 238.873032 C 624.383911 260.113037 623.66748 274.87323 603.147522 274.878235 Z"
        />
        <path
          fill="none"
          stroke={strokeColor}
          strokeWidth={strokeWidth}
          d="M 824.472168 293.904053 L 886.752197 293.888824 L 886.74646 270.488831 C 880.626526 270.850311 870.906616 271.212708 862.62677 271.934723 C 863.704224 261.494446 864.06134 249.61438 864.05957 242.414368 C 864.053406 217.214371 864.409546 201.374283 864.403381 176.174286 C 864.751831 129.014191 842.066711 108.13974 800.666687 108.149872 C 758.546692 108.160187 726.151367 127.248138 726.157959 154.248123 C 726.160889 166.128128 733.363342 176.20636 746.323425 176.563187 C 761.443542 176.919495 767.560608 165.037994 767.558533 156.397995 C 767.557617 152.797989 766.836243 147.038162 763.235168 142.719055 C 769.713074 134.077454 781.232056 130.114655 792.031982 129.752014 C 815.791992 129.746185 820.836304 147.384949 820.841431 168.264954 L 820.846252 188.064957 C 772.606628 189.516754 717.171204 208.25032 717.182312 253.610321 C 717.188721 279.89032 735.193604 299.685913 767.953613 299.677917 C 787.393555 299.673157 806.111816 292.468567 822.667786 275.90451 C 823.029358 282.384399 823.030396 286.704407 824.472168 293.904053 Z M 820.491455 209.305038 C 820.494263 220.825043 820.496948 231.625031 820.498535 238.105042 C 820.499817 243.505035 820.501099 248.545029 820.502319 253.585037 C 810.784668 263.307434 799.62616 269.430145 785.946167 269.433502 C 774.066162 269.436401 763.264587 262.959045 762.900879 247.839127 C 762.174805 222.999313 791.692017 211.472092 820.491455 209.305038 Z"
        />
      </svg>

      <Space h="xl" />

      <Box id="counter" className={classes.number} />
    </Container>
  )
}
